// ========================================================================== //
// EZPZ FLEXBOX GRID - (VI Company) http://vicompany.nl
// ========================================================================== //

// Setup - Values may be edited - !!!DO NOT REMOVE THESE VARIABLES!!!
// ========================================================================== //

$ezpz-auto-generate:			true !default;

$ezpz-namespace:				'.grid' !default;
$ezpz-cell-namespace:			'.cell' !default;
$ezpz-grid-type:				'columns' !default;	// 'columns' or 'fractions'
$ezpz-grid-default-wrap:		'nowrap' !default;	// 'nowrap', 'wrap' or 'reverse'
$ezpz-grid-default-align:		'stretch' !default; // 'stretch', 'start', 'center', 'end' or 'baseline'
$ezpz-gutter: 					1rem !default;


// Only used when $ezpz-grid-type is set to 'columns'
$ezpz-columns: 					12 !default;

// Only used when $ezpz-grid-type is set to 'fractions'
$ezpz-fractions:				(1:2),
								(1:3),
								(2:3),
								(1:4),
								(3:4) !default;

// Breakpoints
// Please note that adding more breakpoints adds quite a lot of extra css depending on the optional features
$ezpz-breakpoints: 				(
									'tiny':		25rem,
									'small':	37.5rem,
									'medium':	60rem,
									'large':	90rem
								) !default;

// Optional grid features - Set to true to enable
$ezpz-grid-align:				false !default;
$ezpz-grid-wrap:				false !default;
$ezpz-cell-order:				false !default;
$ezpz-cell-offset:				false !default;
$ezpz-cell-align:				false !default;
$ezpz-gutter-collapse:			false !default;




// Grid generator - !!!DO NOT EDIT OR REMOVE ANTHING BELOW THIS LINE!!!
// ==========================================================================

$is-columns: if($ezpz-grid-type == 'columns', true, false);
$is-fractions: if($ezpz-grid-type == 'fractions', true, false);
$total-cells: if($ezpz-grid-type == 'columns', $ezpz-columns, length($ezpz-fractions));


// Utils
// ==========================================================================
@function format-breakpoint($breakpoint) {
	@return if($breakpoint, '--' + $breakpoint + '-', '--');
}

@function format-modifier($key, $val) {
	@return $key + '\\/' + $val;
}


// Cells
// ==========================================================================
@mixin generate-all-cells() {
	@if($is-columns or $is-fractions) {
		@include create-cells();
	}
}

@mixin create-cells($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	@if($is-columns) {
		@for $i from 1 through $ezpz-columns {
			& > #{$ezpz-cell-namespace}#{$breakpoint}#{$i} {
				@include create-cell($i);
			}
		}
	} @else {
		& > #{$ezpz-cell-namespace}#{$breakpoint}1 {
			@include create-cell(1);
		}

		@each $fraction in $ezpz-fractions {
			@each $key, $val in $fraction {
				$modifier: format-modifier($key, $val);

				& > #{$ezpz-cell-namespace}#{$breakpoint}#{$modifier} {
					@include create-cell($key / $val);
				}
			}
		}
	}
}

// Accepts number input
//	- @include create-cell(3)
//	- @include create-cell(1/4)
@mixin create-cell($column: 1) {
	flex: 0 0 auto;

	@if (type-of($column) != number) {
		@error 'create-cell: Please define a number variable.';
	}

	@if($is-columns) {
		width: (100% / $ezpz-columns) * $column;
	} @else if ($is-fractions) {
		@if ($column > 1) {
			@error 'create-cell: Make sure you entered a valid fraction value. E.g. "1/2" or "3/4"';
		} @else {
			width: percentage($column);
		}
	}
}


// Alignment of all cells within a grid section
// ==========================================================================
@mixin grid-align($value: 'stretch') {
	$values: (
		stretch: 'stretch',
		start: 'flex-start',
		center: 'center',
		end: 'flex-end',
		baseline: 'baseline'
	);

	@if map-has-key($values, $value) {
		align-items: #{map-get($values, $value)};
	} @else {
		@error 'grid-align: Please enter a valid property; "flex-start", "flex-end", "center" or "stretch"';
	}
}

@mixin generate-grid-align($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}align-stretch {
		@include grid-align();
	}

	&#{$breakpoint}align-start {
		@include grid-align('start');
	}

	&#{$breakpoint}align-end {
		@include grid-align('end');
	}

	&#{$breakpoint}align-center {
		@include grid-align('center');
	}

	&#{$breakpoint}align-baseline {
		@include grid-align('baseline');
	}
}


// Grid section with automatically wrapping cells
// ==========================================================================
@mixin grid-wrap($value: $ezpz-grid-default-wrap) {
	$values: (
		wrap: 'wrap',
		reverse: 'wrap-reverse',
		nowrap: 'nowrap'
	);

	@if map-has-key($values, $value) {
		flex-wrap: #{map-get($values, $value)};
	} @else {
		@error "grid-wrap: Please enter a valid property; 'nowrap', 'wrap' or 'reverse'";
	}
}

@mixin generate-grid-wrap($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}wrap {
		@include grid-wrap('wrap');

		> #{$ezpz-cell-namespace} {
			flex-basis: auto;
		}
	}

	&#{$breakpoint}wrap-reverse {
		@include grid-wrap('reverse');

		> #{$ezpz-cell-namespace} {
			flex-basis: auto;
		}
	}

	&#{$breakpoint}nowrap {
		@include grid-wrap('nowrap');
	}
}

// Cell order (order is 0 by default)
// ==========================================================================
@mixin cell-order($value: 'start') {
	@if ($value == 'start') {
		order: -1;
	} @else if ($value == 'end') {
		order: $total-cells;
	} @else {

		@if (type-of($value) != number) {
			@error 'cell-order: Please enter a valid property; "start", "end" or a number';
		}

		order: $value;
	}
}

@mixin generate-cell-order($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}order {
		// Useful for pulling a single column to the front of the row
		&-start {
			@include cell-order(start);
		}

		// Useful for pushing a single column to the end of the row
		&-end {
			@include cell-order(end);
		}

		// Create offset classes used to control cell order
		@for $i from 1 through $total-cells {
			&-#{$i} {
				@include cell-order($i - 1);
			}
		}
	}
}


// Cell positioning through offset
// ========================================================================== */
@mixin generate-cell-offset($breakpoint: null) {

	// Generate the offset classes for a column based grid
	@if($is-columns) {
		@include cell-column-offset($breakpoint);
	}
	// Generate the offset classes for a fraction based grid
	@else if($is-fractions) {
		@include cell-fraction-offset($breakpoint);
	}
}

@mixin cell-column-offset($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}offset {
		&-0 {
			margin-left: 0;
		}

		@for $i from 1 through $ezpz-columns {
			&-#{$i} {
				@include cell-offset($i);
			}
		}
	}
}

@mixin cell-fraction-offset($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}offset-0 {
		margin-left: 0;
	}

	&#{$breakpoint}offset-1 {
		margin-left: 100%;
	}

	@each $fraction in $ezpz-fractions {
		@each $key, $val in $fraction {
			$modifier: format-modifier($key, $val);

			&#{$breakpoint}offset-#{$modifier} {
				@include cell-offset($key / $val);
			}
		}
	}
}

@mixin cell-offset($value: 1) {
	@if (type-of($value) != number) {
		@error 'Please define a number variable.';
	}

	@if($is-columns) {
		margin-left: (100% / $ezpz-columns) * $value;
	} @else if ($is-fractions) {
		@if ($value > 1) {
			@error 'create-offset: Make sure you entered a valid fraction value. E.g. "1/2" or "3/4"';
		} @else {
			margin-left: percentage($value);
		}
	}
}


// Alignment of individual cells
// ==========================================================================
@mixin cell-align($value: 'stretch') {
	$values: (
		start: 'flex-start',
		end: 'flex-end',
		center: 'center',
		stretch: 'stretch',
		baseline: 'baseline'
	);

	 @if map-has-key($values, $value) {
		 align-self: #{map-get($values, $value)};
	 } @else {
		 @error 'cell-align: Please enter a valid property; "flex-start", "flex-end", "center" or "stretch"';
	 }
}

@mixin generate-cell-align($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}align {
		&-start {
			@include cell-align(start);
		}

		&-end {
			@include cell-align(end);
		}

		&-center {
			@include cell-align(center);
		}

		&-stretch {
			@include cell-align(stretch);
		}

		&-baseline {
			@include cell-align(baseline);

			// TODO: Remove this hack to get grid--align-baseline working in Firefox. This should automatically be resolved after tackling Github issues #19 and #22
			display: inline-block;
		}
	}
}


// Grid or cell without gutters
// ==========================================================================

@mixin grid-gutter-collapsed($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}collapsed {
		& > #{$ezpz-cell-namespace} {
			@include gutter-collapsed();
		}
	}
}

@mixin grid-gutter-expanded($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}expanded {
		& > #{$ezpz-cell-namespace} {
			@include gutter-expanded();
		}
	}
}

@mixin cell-gutter-collapsed($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}collapsed {
		@include gutter-collapsed();
	}
}

@mixin cell-gutter-expanded($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint}expanded {
		@include gutter-expanded();
	}
}

@mixin gutter-collapsed() {
	padding: 0;
}

@mixin gutter-expanded() {
	padding: 0 ($ezpz-gutter / 2);
}


// Create responsive classes for all additional options
// ==========================================================================
@mixin create-responsive-classes() {
	@each $breakpoint, $size in $ezpz-breakpoints {
		@media (min-width: $size) {
			// Base
			@include create-cells($breakpoint);
			@include generate-grid-layout($breakpoint);

			// Optional
			@if $ezpz-grid-align {
				@include generate-grid-align($breakpoint);
			}

			@if $ezpz-grid-wrap {
				@include generate-grid-wrap($breakpoint);
			}

			@if $ezpz-cell-order {
				& > #{$ezpz-cell-namespace} {
					@include generate-cell-order($breakpoint);
				}
			}

			@if $ezpz-cell-offset {
				& > #{$ezpz-cell-namespace} {
					@include generate-cell-offset($breakpoint);
				}
			}

			@if $ezpz-gutter-collapse {
				@include grid-gutter-collapsed($breakpoint);
				@include grid-gutter-expanded($breakpoint);

				& > #{$ezpz-cell-namespace} {
					@include cell-gutter-collapsed($breakpoint);
					@include cell-gutter-expanded($breakpoint);
				}
			}

			@if $ezpz-cell-align {
				& > #{$ezpz-cell-namespace} {
					@include generate-cell-align($breakpoint);
				}
			}
		}
	}
}


// Base
// ==========================================================================
@mixin create-grid() {
	flex-direction: row;
	box-sizing: border-box;
	display: flex;
	@include grid-wrap($ezpz-grid-default-wrap);
	@include grid-align($ezpz-grid-default-align);

	margin-right: -($ezpz-gutter / 2);
	margin-left: -($ezpz-gutter / 2);
}

@mixin create-grid-cell() {
	// Not using flex shorthand because IE 10/11 ignore shorthand declarations with a unitless flex-basis value
	// https://github.com/philipwalton/flexbugs#4-flex-shorthand-declarations-with-unitless-flex-basis-values-are-ignored
	flex-basis: 0%;
	flex-direction: column;
	flex-grow: 1;
	flex-shrink: 1;

	box-sizing: border-box;

	// TODO: Remove this hack to get grid--align-baseline working in Firefox. This should automatically be resolved after tackling Github issues #19 and #22
	@if $ezpz-grid-default-align == 'baseline' {
		display: inline-block;
	} else {
		// Child items of a grid section also have display flex to allow same-height (stretched) modules within multiple cells
		display: flex;
	}

	max-width: 100%;
	padding: 0 ($ezpz-gutter / 2);

	> * {
		// All direct child elements within a cell try to use up the maximum (and same) amount of available space
		flex-grow: 1;
	}
}

@mixin generate-full-grid() {
	@include create-grid();

	> #{$ezpz-cell-namespace} {
		@include create-grid-cell();
	}
}

@mixin generate-grid-layout($breakpoint: null) {
	$breakpoint: format-breakpoint($breakpoint);

	&#{$breakpoint} {
		&horizontal {
			@include grid-layout(horizontal);
		}

		&vertical {
			@include grid-layout(vertical);

			// Maintain cells as full width rows even if the default grid alignment is set to 'start', 'center' or 'end'
			align-items: stretch;

			// IE Fix to prevent cells from not having a height in a vertical grid layout
			> #{$ezpz-cell-namespace} {
				flex-basis: auto;
			}
		}
	}
}

@mixin grid-layout($value: 'horizontal') {
	$values: (
		horizontal: 'row',
		vertical: 'column'
	);

	 @if map-has-key($values, $value) {
		 flex-direction: #{map-get($values, $value)};
	 } @else {
		 @error 'grid-layout allowed properties: "horizontal" and "vertical"';
	 }
}


// Generate all the things
// ==========================================================================
@mixin base() {
	#{$ezpz-namespace} {
		@include generate-full-grid();
		@include generate-grid-layout();
		@include generate-all-cells();

		// Optional
		@if $ezpz-grid-align {
			@include generate-grid-align();
		}

		@if $ezpz-grid-wrap {
			@include generate-grid-wrap();
		}

		@if $ezpz-cell-order {
			& > #{$ezpz-cell-namespace} {
				@include generate-cell-order();
			}
		}

		@if $ezpz-cell-offset {
			& > #{$ezpz-cell-namespace} {
				@include generate-cell-offset();
			}
		}

		@if $ezpz-gutter-collapse {
			@include grid-gutter-collapsed();
			@include grid-gutter-expanded();

			& > #{$ezpz-cell-namespace} {
				@include cell-gutter-collapsed();
				@include cell-gutter-expanded();
			}
		}

		@if $ezpz-cell-align {
			& > #{$ezpz-cell-namespace} {
				@include generate-cell-align();
			}
		}

		// Responsive classes
		@include create-responsive-classes();

		// TODO: Remove this hack to get grid--align-baseline working in Firefox. This should automatically be resolved after tackling Github issues #19 and #22
		&#{$ezpz-namespace}--align-baseline {
			> .cell {
				display: inline-block;
			}
		}
	}
}

@if ($ezpz-auto-generate) {
	@include base();
}
